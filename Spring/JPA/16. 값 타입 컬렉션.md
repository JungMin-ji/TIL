## 값 타입 컬렉션

Member에서 Address를 List로 관리하고 싶을 때 

→ DB로 표현하면 MEMBER 테이블과  ADDRESS 테이블이 일대다 관계!

### 사용법

```jsx
@ElementCollection
@CollectionTable(name="테이블명", 
joinColumns = @JoinColumn(name="MEMBER_ID")
private List<Address> addressHistory = new ArrayList<>();
```

### 특징

- **값 타입 저장** : 값 타입의 생명 주기는 해당 엔티티의 의존적이다! → member만 persist(저장)해도 address 자동으로 저장됨

    - 값 타입 컬렉션은 연속성 전이(Casecade) + 고아 객체 제거 기능을 필수로 가짐 

- **값 타입 조회** : 지연 로딩 전략 사용
- **값 타입 수정** : setter 사용x → 삭제하고, 완전히 new 생성해서 갈아끼워야 함

### 값 타입 컬렉션의 제약사항

- 엔티티와 달리 값 타입은 식별자 개념이 없기 때문에 변경 시 추적이 어렵다.
- 값 타입 컬렉션에 변경 사항이 발생하면, 주인 엔티티와 연관된 모든 데이터를 삭제하고, 값 타입 컬렉션에 있는 현재 값을 모두 다시 저장한다.

    → 여기서 변경되지 않는 값들도 삭제하고 다시 컬렉션에 저장한다! 

- 값 타입 컬렉션을 매핑하는 테이블은 모든 컬럼을 묶어서 기본 키를 구성해야 함 → null x, 중복 저장x

> 실무에서는 상황에 따라 일대다 관계를 사용하여 값 타입 컬렉션을 대신한다.

💡 값 타입 컬렉션은 굉장히! 단순할 때만 사용하고, 아닌 경우 엔티티로 사용한다!
